query GetPullRequestForCommit($owner: String!, $repo: String!, $sha: String) {
  repository(name: $repo, owner: $owner) {
    commit: object(expression: $sha) {
      ... on Commit {
        associatedPullRequests(first: 1) {
          nodes {
            ... on PullRequest {
              id
              number
              comments(first: 100) {
                nodes {
                  id
                  url
                  author {
                    login
                  }
                  body
                }
                pageInfo {
                  hasNextPage
                }
              }
            }
          }
        }
      }
    }
  }
}

query GetPullRequestForURI($uri: URI!) {
  resource(url: $uri) {
    ... on PullRequest {
      id
      number
      comments(first: 100) {
        nodes {
          id
          url
          author {
            login
          }
          body
        }
        pageInfo {
          hasNextPage
        }
      }
    }
  }
}

query GetPullRequestForBranch($owner: String!, $repo: String!, $headref: String, $baseref: String) {
  repository(owner: $owner, name: $repo) {
    pullRequests(
      states: [OPEN, CLOSED, MERGED]
      first: 1
      headRefName: $headref
      baseRefName: $baseref
    ) {
      nodes {
        ... on PullRequest {
          number
          id
          comments(first: 100) {
            nodes {
              id
              url
              author {
                login
              }
              body
            }
            pageInfo {
              hasNextPage
            }
          }
        }
      }
    }
  }
}

query GetPullRequestAndCommentsForCommit($owner: String!, $repo: String!, $sha: String) {
  repository(name: $repo, owner: $owner) {
    commit: object(expression: $sha) {
      ... on Commit {
        associatedPullRequests(first: 1) {
          nodes {
            ... on PullRequest {
              number
              id
              comments(first: 100) {
                nodes {
                  id
                  url
                  author {
                    login
                  }
                  body
                }
                pageInfo {
                  hasNextPage
                }
              }
            }
          }
        }
      }
    }
  }
}


# {
#  "headref": "gorun",
#  "baseref": "main",
#  "repo": "commentary",
#  "owner": "StevenACoffman",
#  "sha": "78ab2494f5f411a8205641ebd084e15ef0a99bf7",
#  "uri": "https://github.com/StevenACoffman/commentary/pull/1"
# }

query GetCommentsForPullRequest($uri: URI!) {
  resource(url: $uri) {
    ... on PullRequest {
      comments(first: 100) {
        nodes {
          id
          url
          author {
            login
          }
          body
        }
        pageInfo {
          hasNextPage
        }
      }
    }
  }
}

# {
#   "url": "https://github.com/Khan/districts-jobs/pull/499"
# }

mutation UpdatePullRequestComment($commentId: ID!, $body: String!) {
  updateIssueComment(input: { id: $commentId, body: $body }) {
    issueComment {
      id
    }
  }
}

mutation CreateNewPullRequestComment($prId: ID!, $body: String!) {
  addComment(input: { subjectId: $prId, body: $body }) {
    commentEdge {
      node {
        id
      }
    }
  }
}